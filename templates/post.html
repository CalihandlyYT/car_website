<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='icon-192x192.png') }}">
    <link rel="icon" type="image/png" sizes="192x192" href="{{ url_for('static', filename='icon-192x192.png') }}">
    <link rel="icon" type="image/png" sizes="96x96" href="{{ url_for('static', filename='icon-96x96.png') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='icon-96x96.png') }}">
    <link rel="shortcut icon" href="{{ url_for('favicon') }}">
    <link rel="apple-touch-icon" sizes="192x192" href="{{ url_for('static', filename='icon-192x192.png') }}">
    <link rel="apple-touch-icon" sizes="152x152" href="{{ url_for('static', filename='icon-152x152.png') }}">
    <title>{{ post.name }}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f4f4f4; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .post-img { width: 100%; height: 400px; object-fit: cover; border-radius: 8px; }
        .specs { background: #f9f9f9; padding: 15px; border-radius: 8px; }
        .comment { border-left: 3px solid #3498db; padding: 10px; margin: 10px 0; background: #f9f9f9; }
        .back { display: block; margin: 20px 0; color: #3498db; text-decoration: none; }
        .like-btn { color:  'red' if post.liked else 'gray' ; text-decoration: none; }
        .comments-section { margin-top: 30px; }
        .comment-form textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        .comment-form button { padding: 10px 15px; background: #27ae60; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <a href="{{ url_for('index') }}" class="back">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
        <h1>{{ post.name }}</h1>
        
        {% if post.category %}
        <span style="display: inline-block; padding: 5px 10px; background: #667eea; color: white; border-radius: 5px; font-size: 0.9em; margin-bottom: 10px;">{{ post.category|title }}</span>
        {% endif %}
        {% if post.tags %}
        <div style="margin-bottom: 10px;">
            {% for tag in post.tags %}
            <span style="display: inline-block; padding: 3px 8px; background: #f0f2ff; color: #667eea; border-radius: 3px; font-size: 0.85em; margin-right: 5px;">#{{ tag }}</span>
            {% endfor %}
        </div>
        {% endif %}
        
        {% if post.video_url %}
        <div style="margin-bottom: 20px;">
            <iframe width="100%" height="500" src="{{ post.video_url }}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="border-radius: 8px;"></iframe>
        </div>
        {% endif %}
        
        {% if post.image %}
        <img src="{{ post.image }}" alt="{{ post.name }}" class="post-img" 
             onerror="this.onerror=null; this.src='https://upload.wikimedia.org/wikipedia/commons/thumb/a/ac/No_image_available.svg/300px-No_image_available.svg.png'; this.style.opacity='0.5';">
        {% else %}
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/ac/No_image_available.svg/300px-No_image_available.svg.png" alt="No image" class="post-img" style="opacity: 0.5;">
        {% endif %}
        
        {% if post.images %}
        <div style="margin-top: 15px;">
            <h3>üì∏ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; margin-top: 10px;">
                {% for img in post.images %}
                <img src="{{ img }}" style="width: 100%; height: 150px; object-fit: cover; border-radius: 8px; cursor: pointer;" onclick="window.open('{{ img }}', '_blank')">
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        <p><strong>–ê–≤—Ç–æ—Ä:</strong> {{ post.author }} | <strong>–î–∞—Ç–∞:</strong> {{ post.created_at }}</p>
        
        <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
        <div style="margin: 20px 0; display: flex; gap: 10px; flex-wrap: wrap;">
            <button onclick="toggleFavorite({{ post.id }})" style="padding: 10px 15px; background: {{ '#f5576c' if post.favorited else '#f0f0f0' }}; color: {{ 'white' if post.favorited else '#333' }}; border: none; border-radius: 5px; cursor: pointer;">
                {{ '‚≠ê' if post.favorited else '‚òÜ' }} –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
            </button>
            {% set author_email = post.author.lower() + '@example.com' %}
            <button onclick="toggleSubscription('{{ author_email }}')" style="padding: 10px 15px; background: {{ '#667eea' if post.subscribed else '#f0f0f0' }}; color: {{ 'white' if post.subscribed else '#333' }}; border: none; border-radius: 5px; cursor: pointer;">
                {{ '‚úì' if post.subscribed else '+' }} –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è
            </button>
            <button onclick="reportPost({{ post.id }})" style="padding: 10px 15px; background: #f5576c; color: white; border: none; border-radius: 5px; cursor: pointer;">‚ö†Ô∏è –ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è</button>
            <button onclick="addToCompare({{ post.id }})" style="padding: 10px 15px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">üîç –°—Ä–∞–≤–Ω–∏—Ç—å</button>
        </div>

        <h2>üîß –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h2>
        <div class="specs">
            <ul>
                {% for k, v in post.specs.items() %}
                    <li><strong>{{ k }}:</strong> {{ v }}</li>
                {% endfor %}
            </ul>
        </div>

        <h2>‚úÖ –ü–ª—é—Å—ã</h2>
        <ul>
            {% for p in post.pros %}
                <li>{{ p }}</li>
            {% endfor %}
        </ul>

        <h2>‚ùå –ú–∏–Ω—É—Å—ã</h2>
        <ul>
            {% for c in post.cons %}
                <li>{{ c }}</li>
            {% endfor %}
        </ul>

        <!-- –õ–∞–π–∫ -->
        <p>
            <a href="{{ url_for('like_post', post_id=post.id) }}" class="like-btn">
                ‚ù§Ô∏è {{ post.likes }} –ù—Ä–∞–≤–∏—Ç—Å—è
            </a>
        </p>

        <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
        <div class="comments-section">
            <h3>üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ({{ comments|length }})</h3>
            {% for c in comments %}
                <div class="comment">
                    <strong>{{ c.author }}</strong> <small>{{ c.created_at }}</small>
                    <p>{{ c.text }}</p>
                    <button onclick="reportComment({{ post.id }}, {{ loop.index0 }})" style="padding: 5px 10px; background: #f5576c; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 0.85em; margin-top: 5px;">‚ö†Ô∏è –ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è</button>
                </div>
            {% else %}
                <p>–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.</p>
            {% endfor %}

            <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
            <form method="post" action="{{ url_for('add_comment_route', post_id=post.id) }}" class="comment-form">
                <textarea name="text" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." required></textarea>
                <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </form>
        </div>
    </div>
    
    <script>
        let comparePosts = [];
        
        function toggleFavorite(postId) {
            fetch(`/toggle_favorite/${postId}`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'}
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                }
            });
        }
        
        function toggleSubscription(authorEmail) {
            fetch(`/toggle_subscription/${encodeURIComponent(authorEmail)}`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'}
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                }
            });
        }
        
        function reportPost(postId) {
            const reason = prompt('–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –∂–∞–ª–æ–±—ã:');
            if (!reason) return;
            
            const formData = new FormData();
            formData.append('target_type', 'post');
            formData.append('target_id', postId);
            formData.append('reason', reason);
            
            fetch('/report', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('–ñ–∞–ª–æ–±–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞–º');
                }
            });
        }
        
        function reportComment(postId, commentIndex) {
            const reason = prompt('–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –∂–∞–ª–æ–±—ã –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:');
            if (!reason) return;
            
            // –ü–æ–ª—É—á–∞–µ–º ID –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è (–Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –≤ —à–∞–±–ª–æ–Ω)
            const formData = new FormData();
            formData.append('target_type', 'comment');
            formData.append('target_id', postId); // –í—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º post_id, –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å comment_id
            formData.append('reason', reason);
            
            fetch('/report', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('–ñ–∞–ª–æ–±–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞–º');
                }
            });
        }
        
        function addToCompare(postId) {
            if (comparePosts.length === 0) {
                comparePosts.push(postId);
                alert('–ü–µ—Ä–≤—ã–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å –≤—ã–±—Ä–∞–Ω. –í—ã–±–µ—Ä–∏—Ç–µ –≤—Ç–æ—Ä–æ–π –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è.');
            } else if (comparePosts.length === 1) {
                comparePosts.push(postId);
                window.location.href = `/compare?post1=${comparePosts[0]}&post2=${comparePosts[1]}`;
            } else {
                comparePosts = [postId];
                alert('–í—ã–±—Ä–∞–Ω –Ω–æ–≤—ã–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å. –í—ã–±–µ—Ä–∏—Ç–µ –≤—Ç–æ—Ä–æ–π –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è.');
            }
        }
    </script>
</body>
</html>

